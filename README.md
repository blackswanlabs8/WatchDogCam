# WatchDogCam

Telegram-бот для мониторинга IP-камер в локальной сети. Бот хранит список камер в JSON-файле, каждые 5 минут пингует доступные камеры и уведомляет в Telegram об изменении статуса.

## Возможности
- Периодическая проверка камер (по умолчанию каждые 5 минут).
- Хранение списка камер в локальном JSON-файле.
- Уведомления при смене статуса «работает» / «не работает».
- Управление списком камер через команды бота (/add, /edit, /delete).
- Просмотр всех камер, только online/offline камер и статистики.

## Запуск
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Установите переменные окружения:
   - `TELEGRAM_TOKEN` — токен Telegram-бота.
   - `TELEGRAM_CHAT_ID` — ID чата, куда отправлять уведомления.
   - `CAMERAS_FILE` — путь к JSON-файлу с камерами (по умолчанию `cameras.json`).
   - `CHECK_INTERVAL_SECONDS` — интервал проверки в секундах (по умолчанию 300).
   - `PING_TIMEOUT_SECONDS` — таймаут пинга в секундах (по умолчанию 1).
3. Запустите бота:
   ```bash
   python -m watchdogcam.main
   ```

## Формат файла камер
Файл `CAMERAS_FILE` хранит массив камер со следующими полями:

```json
[
  {
    "id": "cam-1",
    "name": "Вход",
    "ip": "192.168.1.10",
    "enabled": true,
    "last_status": "online",
    "previous_status": "online",
    "last_check_at": "2025-01-10T12:30:00",
    "last_status_change_at": "2025-01-10T11:00:00"
  }
]
```

## Основные команды бота
- `/start` — описание возможностей.
- `/all` — список всех активных камер и их статуса.
- `/online` — камеры со статусом `online`.
- `/offline` — камеры со статусом `offline`.
- `/stats` — краткая статистика.
- `/add` — диалоговое добавление камеры.
- `/edit` — изменение названия или IP камеры по IP/ID.
- `/delete` — удаление камеры по IP/ID.
- `/check` — ручной запуск проверки (полезно для диагностики).

## Мониторинг и уведомления
- Проверка запускается планировщиком в боте каждые `CHECK_INTERVAL_SECONDS` секунд.
- Камеры с `enabled = false` пропускаются при проверках.
- Уведомления отправляются только при смене статуса с online → offline или обратно.
